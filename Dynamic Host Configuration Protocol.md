# Dynamic Host Configuration Protocol #
**Dynamic Host Configuration Protocol** o **DHCP**,  è un protocollo che assegna dinamicamente ad un host un indirizzo IP.

Si supponga, in ogni [[LAN]], uno o più server DHCP collegati alle varie subnet in cui può essere organizzata questa struttura di rete e si supponga che tutti i client, i quali sono collegati a questa rete, non abbiano assegnato un IP Address a configuration time da parte dell'admin. Perciò, se i client vogliono essere identificabili in rete, devono richiedere l'IP Address e, in base ad una richiesta esplicita, ci sarà una risposta da parte del server con l’IP address che deve essere assegnato dinamicamente a questa macchina al momento della richiesta. Il fatto che sia **dynamic** sottende l'esistenza di un pool di indirizzi tra i quali pescare. Il server, tramite DHCP, assegnerà temporaneamente un indirizzo IP dal pool alla macchina richiedente elo assegnerà per un tempo prefissato, stabilito all’atto della negoziazione client-server. Successivamente, questo IP address scadrà di validità e se questo client avrà ancora bisogno di un IP, dovrà fare una nuova negoziazione o chiedere l'assegnazione di un nuovo IP.

Ci si aspetta un protocollo molto semplice di tipo Client-Server in cui, in modo convenzionale, la macchina client fa una richiesta al server, il quale la processa e produce una reply con la risposta assegnata. Quello che specifica, in verità, il protocollo DHCP è poco più complesso ed è descritto nell’RFC 2131 (**Request For Comment**).

Si osservi più nel dettaglio il protocollo DHCP.
Si supponga di avere il tempo che evolve in questa direzione. Il client, al momento del boot, si trova senza un IP associato e non ha un'identità in internet. L’unico modo per risolvere questo problema è fare una richiesta esplicita al server della propria rete. Questa richiesta è la **DHCP discover**. Quando il server riceve la discover, risponde con una **DHCP offer**. Il protocollo non termina a questo punto perchè ha un ulteriore messaggio che è la **DHCP request** e un quarto, **DHCP ACK**.
La request è effettivamente la DHCP discover, la reply è quella che viene chiamata offer mentre gli altri due messaggi sono in più, richiesti dal protocollo specificato dall’RFC. Perchè questo è un protocollo a 4 vie ( 4 scambi di messaggi) e non a 2? La ragione è che alla rete possono essere collegati più server; è fondamentale ipotizzare che la richiesta del client raggiunga non un solo server ma, ragionevolmente, tutti. Ognuno dei server risponderà con la corrispettiva offer. Se un client, a fronte di una discover, riceve multiple offer, dovrà selezionare una di queste. Il criterio di selezione viene scelto autonomamente dal client. Non è possibile acquisire più di un IP Address da associare per un certo periodo al client.
Quindi con la request, si informeranno i server della rete di quale di essi è stato selezionato per diventare l’assegnatario dell’IP Address temporaneo.

Ora è necessario risolvere altri problemi di dettaglio. Primo, DHCP usa pacchetti IP, quindi avrà un header IP, che ha un formato IP source e IP destination. Ma, ovviamente, il client non ha ancora un IP quando fa la richiesta. L’IP viene quindi messo a 0 di default.
Qual è l’IP destinazione se la macchina client ancora non sa qual è l’indirizzo IP del server, soprattutto se ce n’è più di uno? Come IP destinazione verrà inserito 255.255.255.255 Broadcast. Tutti i server nella rete lo riceveranno. Inoltre è presente un transaction ID, il quale è un numero random che il client produce, all’atto della spedizione della discover, per identificare univocamente questa specifica richiesta. Inoltre, la coppia client-transaction ID identifica univocamente la sequenza a quattro vie.
Ogni specifica transaction ID enumera tutte le richieste del client fatte alla rete DHCP. Questo pacchetto IP viaggia e viene estratto dalla rete da tutti i server DHCP. Il server, a fronte della richiesta, segna in una propria tabella la coppia client-transaction ID e cerca nel pool di indirizzi ID a lui assegnato, uno libero da mandare al Client. 

Qui sorge un piccolo problema. Come identificare il client se tutti si presentano come 0.0.0.0? Non ho modo di mandargli una offer. L’unico indirizzo che il server può usare è il MAC address. Quindi il server apre l’header della frame di livello 2 ed estrae il MAC address. 

Inoltre è presente una fase, **Collect offers**, in cui il client attende per un tempo predefinito tutte le offerte di indirizzo IP dai server della rete.

------------------------------------------------------------