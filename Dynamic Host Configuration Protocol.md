**Dynamic Host Configuration Protocol** o **DHCP**,  è un protocollo che assegna dinamicamente ad un host un indirizzo IP.

Si supponga in ogni LAN uno o più server DHCP collegati alle varie subnet in cui può essere organizzata questa struttura di rete e tutti i client, che sono collegati a questa rete, non hanno assegnato a configuration time da parte dell'admin un IP address per cui, se vogliono essere identificabili in rete, devono richiederlo e in base ad una richiesta esplicita, ci sarà una risposta da parte del server con l’IP address che deve essere assegnato dinamicamente a questa macchina al momento della richiesta. Il fatto che sia dynamic indica che avremo un pool di indirizzi tra i quali pescare e il server, tramite DHCP, assegnerà temporaneamente un indirizzo IP dal pool alla macchina richiedente, lo assegnerà per un tempo prefissato che viene stabilito all’atto della negoziazione client-server dopodichè questo Ip address scadrà d validità e se questo client avrà ancora bisogno di un IP dovrà fare una nuova negoziazione o chiedere l'assegnazione di un nuovo IP.

Ci aspettiamo un protocollo molto semplice di tipo Client-Server in cui, in modo convenzionale, la macchina client fa una richiesta al server, il quale la processa e produce una reply con la risposta assegnata. Quello che per la verità il protocollo DHCP specifica è poco più complicato ed è specificato nell’RFC 2131( Request For Comment).

Diamo un’occhiata da più vicino al protocollo DHCP.
Supponiamo di avere il tempo che evolve in questa direzione. Il client è la nostra macchina desktop che al boot si trova senza un IP associato e non ha un'identità in internet. L’unico modo è fare una richiesta esplicita al server della propria rete. Questa richiesta è la DHCP discover. Quando il server riceve la discover, risponde con una DHCP offer. Il protocollo non finisce qui perchè ha un ulteriore messaggio che è DHCP request e un quarto, DHCP ACK.
Già vediamo qualche anomalia rispetto a quello che ci aspettavamo, due coppie di messaggi invece di una ed, in particolare, la richiesta è il terzo messaggio.
La request da noi immaginata è effettivamente la DHCP discover, la reply è quella che viene chiamata offer mentre gli altri due messaggi sono in più richiesti dal protocollo specificato dall’RFC. Perchè questo è un protocollo a 4 vie ( 4 scambi di messaggi) e non a 2? La ragione è che alla rete possono esserci collegati più server; noi dobbiamo quindi ipotizzare che la richiesta del client raggiunga non un solo server ma ragionevolmente tutti. Ognuno dei server risponderà con al corrispettiva offer. Se un client, a fronte di una discover, riceve multiple offer, dovrà selezionare una di queste. Il criterio e lo autonomina il client. Io non posso acquisire più di un IP address da associare per un certo periodo al mio client.
Quindi con la request, dovrò informare i server della rete, quale di essi è stato selezionato per diventare l’assegnatario dell’IP address temporaneo.

Adesso dobbiamo risolvere altri problemi di dettaglio. Primo, DHCP usa pacchetti IP, quindi avrà un header IP, che ha un formato IP source e IP destination. Ma ovviamente il client non ha ancora un IP quando fa la richiesta. L’IP viene quindi messo a 0 di default.
Qual è l’IP destinazione se la macchina client ancora non sa qual è l’indirizzo IP del server, soprattutto se ce n’è più di uno? Come IP destinazione metterò 255.255.255.255 Broadcast. Tutti i server nella rete lo riceveranno. Inoltre c’è un transaction ID che è un random che il client produce, all’atto della spedizione della discover, per identificare univocamente questa specifica richiesta, e la coppia client-transaction ID identifica univocamente la sequenza a quattro vie che stiamo vedendo. Ogni transaction ID specifica, enumera tutte le richieste del client fatte alla rete DHCP e consente alle macchine che lo ricevono, se stanno processando una vecchia richiesta o una nuova. Questo pacchetto IP viaggia e viene estratto dalla rete da tutti i server DHCP. Il server, a fronte della richiesta, segna in una propria tabella la coppia client-transaction ID e cerca nel pool di indirizzi ID a lui assegnato, uno libero da mandare al Client. 

Qui sorge un piccolo problema. Come identificare il client se tutti si presentano come 0.0.0.0? Non ho modo di mandargli una offer. L’unico indirizzo che il server può usare è il MAC address. Quindi il server apre l’header della frame di livello 2 e prende il MAC address. 

Abbiamo una fase, collect offers, in cui il client attende un tot  tutte le offerte di indirizzo IP dai server della rete.
